<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SB Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
</head>

<body class="sb-nav-fixed">
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <a class="navbar-brand ps-3" href="index.html">Start Bootstrap</a>
    </nav>
    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <a class="nav-link" routerLink="/event">Events</a> <!-- Updated link to use routerLink -->
                    </div>
                </div>
            </nav>
        </div>
        <div id="layoutSidenav_content">
            <main>
                <div class="container-fluid px-4">
                    <h1 class="mt-4">Student Management</h1>
                    <div class="card mb-4">
                        <div class="card-header">
                            <i class="fas fa-table me-1"></i>
                            Student List
                        </div>
                        <div class="card-body">
                            <div class="container">
                                <h2>Liste des Étudiants Disponibles</h2>

                                <!-- Formulaire d'ajout d'un étudiant -->
                                <h3>Ajouter un étudiant</h3>
                                <form (ngSubmit)="addEtudiant()" #etudiantForm="ngForm" novalidate>
                                    <div class="form-group">
                                        <label for="nom">Nom</label>
                                        <input type="text" id="nom" [(ngModel)]="newEtudiant.nom" name="nom" class="form-control" required minlength="2">
                                        <div *ngIf="etudiantForm.controls['nom']?.invalid && etudiantForm.controls['nom']?.touched" class="text-danger">
                                            <small *ngIf="etudiantForm.controls['nom']?.errors?.['required']">Le nom est requis.</small>
                                            <small *ngIf="etudiantForm.controls['nom']?.errors?.['minlength']">Le nom doit comporter au moins 2 caractères.</small>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="prenom">Prénom</label>
                                        <input type="text" id="prenom" [(ngModel)]="newEtudiant.prenom" name="prenom" class="form-control" required minlength="2">
                                        <div *ngIf="etudiantForm.controls['prenom']?.invalid && etudiantForm.controls['prenom']?.touched" class="text-danger">
                                            <small *ngIf="etudiantForm.controls['prenom']?.errors?.['required']">Le prénom est requis.</small>
                                            <small *ngIf="etudiantForm.controls['prenom']?.errors?.['minlength']">Le prénom doit comporter au moins 2 caractères.</small>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="email">Email</label>
                                        <input type="email" id="email" [(ngModel)]="newEtudiant.email" name="email" class="form-control" required email>
                                        <div *ngIf="etudiantForm.controls['email']?.invalid && etudiantForm.controls['email']?.touched" class="text-danger">
                                            <small *ngIf="etudiantForm.controls['email']?.errors?.['required']">L'email est requis.</small>
                                            <small *ngIf="etudiantForm.controls['email']?.errors?.['email']">L'email doit être valide.</small>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                      <label for="filiere">Filière</label>
                                      <select id="filiere" [(ngModel)]="newEtudiant.filiere" name="filiere" class="form-control" required>
                                        <option value="" disabled selected>Sélectionnez une filière</option>
                                        <option *ngFor="let filiere of filieres" [value]="filiere">{{ filiere }}</option>
                                      </select>
                                      <div *ngIf="etudiantForm.controls['filiere']?.invalid && etudiantForm.controls['filiere']?.touched" class="text-danger">
                                        <small *ngIf="etudiantForm.controls['filiere']?.errors?.['required']">La filière est requise.</small>
                                      </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="annee">Année</label>
                                        <input type="number" id="annee" [(ngModel)]="newEtudiant.annee" name="annee" class="form-control" required min="1" max="5">
                                        <div *ngIf="etudiantForm.controls['annee']?.invalid && etudiantForm.controls['annee']?.touched" class="text-danger">
                                            <small *ngIf="etudiantForm.controls['annee']?.errors?.['required']">L'année est requise.</small>
                                            <small *ngIf="etudiantForm.controls['annee']?.errors?.['min']">L'année doit être au moins 1.</small>
                                            <small *ngIf="etudiantForm.controls['annee']?.errors?.['max']">L'année ne peut pas dépasser 5.</small>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary" [disabled]="etudiantForm.invalid">Ajouter Étudiant</button>
                                </form>

                                <hr>

                                <!-- Barre de recherche -->
                                <input type="text" [(ngModel)]="searchTerm" (input)="filterEtudiants()" placeholder="Rechercher un étudiant..." class="form-control mb-3" />

                                <!-- Tableau des étudiants -->
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th (click)="changeSortBy('nom')">Nom</th>
                                            <th (click)="changeSortBy('prenom')">Prénom</th>
                                            <th (click)="changeSortBy('email')">Email</th>
                                            <th (click)="changeSortBy('filiere')">Filière</th>
                                            <th (click)="changeSortBy('annee')">Année</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let etudiant of etudiantsFiltres">
                                            <td>{{ etudiant.nom }}</td>
                                            <td>{{ etudiant.prenom }}</td>
                                            <td>{{ etudiant.email }}</td>
                                            <td>{{ etudiant.filiere }}</td>
                                            <td>{{ etudiant.annee }}</td>
                                            <td>
                                                <!-- Vérifier si l'id existe avant d'afficher le bouton supprimer -->
                                                <button *ngIf="etudiant.id" (click)="deleteEtudiant(etudiant.id)" class="btn btn-danger btn-sm">Supprimer</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>

                                
                                
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            <footer class="py-4 bg-light mt-auto">
                <div class="container-fluid px-4">
                    <div class="d-flex align-items-center justify-content-between small">
                        <div class="text-muted">Copyright © Your Website 2023</div>
                        <div>
                            <a href="#">Privacy Policy</a>
                            <a href="#">Terms &amp; Conditions</a>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>