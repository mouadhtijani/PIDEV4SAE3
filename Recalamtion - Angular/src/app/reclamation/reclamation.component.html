<main class="main">
  <section id="hero" class="hero section dark-background">
    <img src="/assets/front/img/hero-bg.jpg" alt="" data-aos="fade-in" />

    <section class="section mt-5">
      <div class="container mt-5">
        <h2 class="text-center mb-4">Submit a Reclamation</h2>

        <!-- ✅ Formulaire affiché uniquement si l'utilisateur n'a pas encore soumis -->
        <form *ngIf="!hasReclamation" (ngSubmit)="submit()" class="row g-3 shadow p-4 bg-white rounded">
          <div class="col-md-6">
            <label for="typeUser" class="form-label">User Type</label>
            <select class="form-select" id="typeUser" [(ngModel)]="newReclamation.typeUser" name="typeUser" required>
              <option value="">Choose...</option>
              <option value="student">Student</option>
              <option value="company">Company</option>
            </select>
          </div>

          <div class="col-md-6">
            <label for="nomUser" class="form-label">User Name</label>
            <input
              type="text"
              class="form-control"
              id="nomUser"
              [(ngModel)]="newReclamation.nomUser"
              name="nomUser"
              required
            />
          </div>

          <div class="col-12">
            <label for="objet" class="form-label">Subject</label>
            <input
              type="text"
              class="form-control"
              id="objet"
              [(ngModel)]="newReclamation.objet"
              name="objet"
              required
            />
          </div>

          <div class="col-12">
            <label for="description" class="form-label">Description</label>
            <textarea
              class="form-control"
              id="description"
              rows="4"
              [(ngModel)]="newReclamation.description"
              name="description"
              required
            ></textarea>
          </div>

          <div class="col-12 text-center">
            <button type="submit" class="btn btn-primary px-5" [disabled]="isSubmitting">Send</button>
          </div>
        </form>

        <!-- Message si l'utilisateur a déjà soumis une réclamation -->
        <div *ngIf="hasReclamation" class="alert alert-info text-center mt-4">
          You have already submitted a reclamation.
        </div>

        <hr class="my-5" />

        <h3 class="text-center mb-3">Your Reclamation</h3>

        <div *ngIf="reclamations.length === 0" class="alert alert-warning text-center">
          No reclamation submitted yet.
        </div>

        <div class="row">
          <div *ngFor="let r of reclamations" class="col-md-8 offset-md-2">
            <div class="card shadow-sm mb-3">
              <div class="card-body">
                <h5 class="card-title">{{ r.objet }}</h5>
                <h6 class="card-subtitle mb-2 text-muted">{{ r.typeUser }} - {{ r.nomUser }}</h6>
                <p class="card-text">{{ r.description }}</p>
                <p class="card-text"><small class="text-muted">Created on: {{ r.dateCreation }}</small></p>

                <!-- ✅ Display Admin's Response (if exists) -->
                <div *ngIf="r.response">
                  <hr />
                  <h6 class="text-success">Admin Response:</h6>
                  <p>{{ r.response.message }}</p>
                  <p><small class="text-muted">Responded on: {{ r.response.responseDate }}</small></p>
                </div>

                <!-- ✅ Delete the reclamation -->
                <button class="btn btn-sm btn-outline-danger mt-3" (click)="delete(r.id!)">Delete</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </section>
</main>
